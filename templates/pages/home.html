{{define "home.html"}}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - {{.TenantName}}</title>

    <!-- Enhanced SEO Meta Tags -->
    <meta name="description" content="{{.TenantName}} - Dealer mobil bekas terpercaya di Indonesia. Jual mobil berkualitas dengan harga terbaik, garansi mesin 1 tahun, test drive gratis, & proses kredit mudah. Temukan Toyota, Honda, Mitsubishi, dan lainnya dengan kondisi prima.">
    <meta name="keywords" content="dealer mobil bekas, jual mobil bekas, beli mobil berkualitas, mobil bekas terpercaya, {{.TenantName}}, Toyota bekas, Honda bekas, Mitsubishi bekas, mobil garansi, test drive mobil, kredit mobil bekas, mobil bekas dijual, harga mobil bekas, showroom mobil">
    <meta name="author" content="{{.TenantName}}">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large">
    <meta name="language" content="id-ID">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{.BaseURL}}/" />

    <!-- Enhanced Open Graph -->
    <meta property="og:title" content="{{.TenantName}} - Dealer Mobil Bekas Terpercaya | Jual & Beli Mobil Berkualitas">
    <meta property="og:description" content="Dealer mobil bekas terpercaya dengan koleksi Toyota, Honda, Mitsubishi berkualitas. Garansi mesin 1 tahun, test drive gratis, & proses kredit mudah. Temukan mobil impian Anda sekarang!">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="{{.TenantName}}">
    <meta property="og:locale" content="id_ID">
    <meta property="og:url" content="{{.BaseURL}}">
    <meta property="og:image" content="{{.LogoPath}}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{.TenantName}} - Dealer Mobil Bekas Terpercaya">

    <!-- Enhanced Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{.TenantName}} - Dealer Mobil Bekas Terpercaya">
    <meta name="twitter:description" content="Jual & beli mobil bekas berkualitas dengan garansi 1 tahun. Test drive gratis & kredit mudah. Toyota, Honda, Mitsubishi tersedia!">
    <meta name="twitter:image" content="{{.LogoPath}}">
    <meta name="twitter:site" content="@{{.TwitterHandle | default "autolmk"}}">

    <!-- Local Business Meta Tags -->
    <meta name="geo.region" content="ID">
    <meta name="geo.placename" content="{{.ShowroomAddress | default "Indonesia"}}">
    <meta name="ICBM" content="{{.GeoCoordinates | default "-6.2088,106.8456"}}">
    <meta name="business:contact_data:street_address" content="{{.ShowroomAddress | default ""}}">
    <meta name="business:contact_data:locality" content="{{.TenantLocation | default "Indonesia"}}">
    <meta name="business:contact_data:country" content="Indonesia">
    {{if .ShowroomPhone}}<meta name="business:contact_data:phone_number" content="{{.ShowroomPhone}}">{{end}}
    {{if .ShowroomEmail}}<meta name="business:contact_data:email" content="{{.ShowroomEmail}}">{{end}}

    <!-- Favicon -->
    {{if .FaviconPath}}
    <link rel="icon" type="image/x-icon" href="{{.FaviconPath}}">
    {{end}}

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/static/css/output.css">

    <!-- Custom CSS (Desktop-First UX/UI) -->
    <link rel="stylesheet" href="/static/css/input.css">

    <!-- Basecoat UI -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css">
    <script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js" defer></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        [x-cloak] { display: none !important; }
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Critical UI Fixes for Main Page */
        .search-input {
            width: 100% !important;
            padding: 20px 24px 20px 60px !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 16px !important;
            font-size: 1rem !important;
            background: white !important;
            height: 64px !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        }

        .search-input:focus {
            outline: none !important;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        }

        .search-input::placeholder {
            color: #6b7280 !important;
        }

        /* WhatsApp Button Critical Fix */
        #whatsapp-button,
        .whatsapp-button,
        .fixed.bottom-6.right-6.z-50 a,
        .fixed.bottom-6.right-6 {
            position: fixed !important;
            bottom: 24px !important;
            right: 24px !important;
            z-index: 9999 !important;
            background: #25d366 !important;
            color: white !important;
            padding: 18px !important;
            border-radius: 50% !important;
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4), 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 68px !important;
            height: 68px !important;
            text-decoration: none !important;
            border: 3px solid white !important;
        }

        /* Enhanced Quick Filter Buttons */
        .mt-8 .btn {
            padding: 12px 20px !important;
            font-weight: 500 !important;
            border-width: 2px !important;
            backdrop-filter: blur(10px) !important;
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
            color: white !important;
            transition: all 0.3s ease !important;
        }

        .mt-8 .btn:hover {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #3b82f6 !important;
            border-color: white !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
        }

        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-suggestions.show {
            display: block;
        }

        .search-suggestions a {
            display: block;
            padding: 12px 24px;
            color: #374151;
            text-decoration: none;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
        }

        .search-suggestions a:hover {
            background-color: #f9fafb;
            color: #3b82f6;
        }

        /* Search Loading Indicator */
        .search-loading {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            z-index: 1001;
        }
    </style>

    <!-- Organization Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "{{.TenantName}}",
        "url": "{{.BaseURL}}",
        "logo": "{{.LogoPath}}",
        "description": "Dealer mobil bekas terpercaya dengan koleksi mobil berkualitas dan harga terbaik di Indonesia",
        {{if .ShowroomAddress}}"address": {
            "@type": "PostalAddress",
            "streetAddress": "{{.ShowroomAddress}}",
            "addressLocality": "{{.TenantName}}",
            "addressCountry": "ID"
        },{{end}}
        {{if .ShowroomPhone}}"telephone": "{{.ShowroomPhone}}",{{end}}
        {{if .ShowroomEmail}}"email": "{{.ShowroomEmail}}",{{end}}
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "{{.WhatsAppNumber}}",
            "contactType": "customer service",
            "availableLanguage": ["Indonesian", "English"],
            "hoursAvailable": [
                "Mo-Sa 09:00-18:00",
                "Su 10:00-16:00"
            ]
        },
        "sameAs": [
            {{if .SocialMediaFacebook}}"https://facebook.com/{{.SocialMediaFacebook}}"{{end}},
            {{if .SocialMediaInstagram}}"https://instagram.com/{{.SocialMediaInstagram}}"{{end}},
            {{if .SocialMediaTwitter}}"https://twitter.com/{{.SocialMediaTwitter}}"{{end}}
        ],
        "areaServed": {
            "@type": "Country",
            "name": "Indonesia"
        },
        "founder": {
            "@type": "Person",
            "name": "{{.TenantName}} Founder"
        },
        "foundingDate": "2020",
        "numberOfEmployees": "11-50",
        "knowsLanguage": ["Indonesian", "English"],
        "legalName": "{{.TenantName}}",
        "taxID": "{{.TenantName}}",
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Mobil Bekas Catalog",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Product",
                        "name": "Mobil Bekas"
                    },
                    "availability": "https://schema.org/InStock"
                }
            ]
        }
    }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation with Basecoat -->
    {{template "nav" .}}

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <div class="hero-gradient text-white section-lg">
            <div class="content-wrapper">
                <div class="text-center max-w-5xl mx-auto">
                    <h1>
                        Cari Mobil Impian Anda
                    </h1>
                    <p class="text-xl mb-8">
                        Jelajahi koleksi mobil bekas pilihan kami dengan kualitas terjamin
                    </p>

                    <!-- Enhanced Search Bar -->
                    <div class="search-container">
                        <form action="/mobil" method="get" hx-get="/mobil" hx-target="#car-suggestions" hx-trigger="keyup changed delay:300ms" hx-indicator="#search-loading">
                            <svg class="search-icon w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <input
                                type="text"
                                name="q"
                                placeholder="Cari merek, model, atau kode mobil..."
                                class="search-input"
                                autocomplete="off"
                            >
                            <!-- Search Loading Indicator -->
                            <div id="search-loading" class="htmx-indicator search-loading">
                                <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </div>
                            <!-- Search Suggestions Dropdown -->
                            <div id="car-suggestions" class="search-suggestions"></div>
                        </form>
                    </div>
                    </div>

                    <!-- Quick Filters -->
                    <div class="mt-8 flex flex-wrap justify-center gap-2">
                        <a href="/mobil" class="btn btn-outline btn-ghost text-white border-white hover:bg-white hover:text-purple-700">
                            Semua Mobil
                        </a>
                        <a href="/mobil?max_price=200000000" class="btn btn-outline btn-ghost text-white border-white hover:bg-white hover:text-purple-700">
                            Di Bawah 200 Juta
                        </a>
                        <a href="/mobil?transmission=AT" class="btn btn-outline btn-ghost text-white border-white hover:bg-white hover:text-purple-700">
                            Automatic
                        </a>
                        <a href="/mobil?transmission=MT" class="btn btn-outline btn-ghost text-white border-white hover:bg-white hover:text-purple-700">
                            Manual
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="card text-center">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Kualitas Terjamin</h3>
                    <p class="text-gray-600">Setiap mobil diperiksa secara menyeluruh untuk ketenangan pikiran Anda</p>
                </div>

                <div class="card text-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Harga Terbaik</h3>
                    <p class="text-gray-600">Harga kompetitif dengan biaya transparan tanpa biaya tersembunyi</p>
                </div>

                <div class="card text-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Pilihan Lengkap</h3>
                    <p class="text-gray-600">Beragam pilihan merek dan model untuk memenuhi kebutuhan Anda</p>
                </div>
            </div>
        </div>

        <!-- Featured Cars Section -->
        <div class="bg-white py-16">
            <div class="content-wrapper">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Mobil Pilihan</h2>
                        <p class="text-gray-600 mt-1">Koleksi terbaik dari kendaraan kami</p>
                    </div>
                    <a href="/mobil" class="btn btn-primary">Lihat Semua â†’</a>
                </div>

                <!-- Featured Cars Loading State -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                     id="featured-cars"
                     hx-get="/api/cars?limit=6&featured=true"
                     hx-trigger="load"
                     hx-swap="innerHTML">
                    <!-- Initial Loading State -->
                    <div class="col-span-full text-center py-12 htmx-indicator">
                        <div class="loading">
                            <div class="animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                            <p class="text-gray-500">Memuat mobil pilihan...</p>
                        </div>
                    </div>
                </div>

                <!-- Error State (hidden by default) -->
                <div id="featured-cars-error" class="hidden col-span-full text-center py-12">
                    <div class="card p-8 border border-red-200 bg-red-50">
                        <svg class="w-12 h-12 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <p class="text-red-700 font-medium">Gagal memuat mobil</p>
                        <button onclick="location.reload()" class="btn btn-secondary mt-4">Coba Lagi</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA Section -->
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl font-bold mb-4">Siap Menemukan Mobil Impian Anda?</h2>
                <p class="text-lg mb-8 text-purple-100">Jelajahi koleksi lengkap kami atau hubungi kami untuk bantuan personal</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="/mobil" class="btn bg-white text-purple-600 hover:bg-gray-100">
                        Lihat Semua Mobil
                    </a>
                    <a href="/kontak" class="btn btn-outline border-white text-white hover:bg-white hover:text-purple-600">
                        Hubungi Kami
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    {{template "footer" .}}

    <!-- WhatsApp Button -->
    {{template "whatsapp-button" .}}

    <!-- Load Featured Cars -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load featured cars via HTMX
            const featuredCarsContainer = document.getElementById('featured-cars');

            fetch('/api/cars?limit=6&featured=true')
                .then(response => response.json())
                .then(data => {
                    if (data.data && data.data.length > 0) {
                        displayFeaturedCars(data.data);
                    } else {
                        // Load all cars if no featured cars
                        fetch('/api/cars?limit=6')
                            .then(response => response.json())
                            .then(allData => {
                                if (allData.data) {
                                    displayFeaturedCars(allData.data);
                                } else {
                                    showNoCarsMessage();
                                }
                            });
                    }
                })
                .catch(error => {
                    console.error('Error loading featured cars:', error);
                    showNoCarsMessage();
                });

            function displayFeaturedCars(cars) {
                const html = cars.map(car => createCarCard(car)).join('');
                featuredCarsContainer.innerHTML = html;
            }

            function createCarCard(car) {
                const price = car.price ? new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(car.price) : 'Harga Negosiasi';

                return `
                    <div class="card hover:shadow-lg transition-shadow">
                        <div class="aspect-w-16 aspect-h-9 bg-gray-200 rounded-t-lg flex items-center justify-center">
                            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                        </div>
                        <div class="p-4">
                            <h3 class="text-lg font-semibold text-gray-900">${car.brand} ${car.model}</h3>
                            <p class="text-2xl font-bold text-blue-600 mt-1">${price}</p>
                            <div class="flex gap-2 mt-2">
                                <span class="badge badge-info">${car.year}</span>
                                <span class="badge badge-secondary">${car.transmission}</span>
                            </div>
                            <a href="/mobil/${car.id}" class="btn btn-primary w-full mt-4">
                                Lihat Detail
                            </a>
                        </div>
                    </div>
                `;
            }

            function showNoCarsMessage() {
                featuredCarsContainer.innerHTML = `
                    <div class="text-center py-12 col-span-full">
                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        <p class="text-gray-500">Belum ada mobil tersedia.</p>
                        <a href="/mobil" class="btn btn-primary mt-4">Lihat Semua Mobil</a>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
{{end}}