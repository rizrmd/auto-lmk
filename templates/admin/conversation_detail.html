{{define "content"}}
<!-- Header Section -->
<div class="bg-white rounded-lg shadow mb-6">
    <div class="p-4 md:p-6 border-b border-gray-200">
        <div class="flex items-center justify-between mb-4">
            <a href="/admin/conversations" class="inline-flex items-center text-gray-600 hover:text-gray-900 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                <span class="font-medium">Kembali ke List</span>
            </a>
        </div>

        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="flex-1">
                <h1 class="text-xl md:text-2xl font-bold text-gray-900">{{.Conversation.PhoneNumber}}</h1>
                <div class="flex items-center gap-3 mt-2">
                    {{if .Conversation.IsSales}}
                    <span class="inline-flex px-2.5 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                        Sales
                    </span>
                    {{else}}
                    <span class="inline-flex px-2.5 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                        Customer
                    </span>
                    {{end}}
                    <span class="text-sm text-gray-500">
                        Dibuat: {{.Conversation.CreatedAt}}
                    </span>
                </div>
            </div>
            <div class="mt-3 md:mt-0">
                <div class="text-sm text-gray-600">
                    Total Pesan: <span class="font-semibold text-gray-900">{{.TotalMessages}}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Message Thread Section -->
<div class="bg-white rounded-lg shadow">
    <div class="p-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Riwayat Percakapan</h2>
    </div>

    <!-- Message Thread -->
    <div id="message-thread" class="p-4 md:p-6 space-y-4 overflow-y-auto bg-gray-50" style="height: 600px; max-height: 70vh;">
        {{if .Messages}}

        <!-- Load Older Messages Button -->
        {{if gt .TotalMessages 50}}
        <div class="text-center mb-4">
            <button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 shadow-sm transition-colors">
                Muat Pesan Lama
            </button>
        </div>
        {{end}}

        <!-- Messages -->
        {{range .Messages}}
        {{if eq .Direction "inbound"}}
        <!-- Inbound Message (Left-aligned) -->
        <div class="flex justify-start">
            <div class="bg-gray-100 rounded-lg p-3 max-w-md md:max-w-lg shadow-sm">
                <p class="text-sm text-gray-900 whitespace-pre-wrap break-words">{{.Content}}</p>
                <div class="mt-1 flex items-center gap-2">
                    <span class="text-xs text-gray-600 font-medium">{{.Sender}}</span>
                    <span class="text-xs text-gray-400">•</span>
                    <span class="text-xs text-gray-500">{{.CreatedAt}}</span>
                </div>
            </div>
        </div>
        {{else}}
        <!-- Outbound Message (Right-aligned) -->
        <div class="flex justify-end">
            <div class="bg-blue-100 rounded-lg p-3 max-w-md md:max-w-lg shadow-sm">
                <p class="text-sm text-gray-900 whitespace-pre-wrap break-words">{{.Content}}</p>
                <div class="mt-1 flex items-center gap-2 justify-end">
                    <span class="text-xs text-blue-700 font-semibold">BOT</span>
                    <span class="text-xs text-gray-400">•</span>
                    <span class="text-xs text-gray-600">{{.CreatedAt}}</span>
                </div>
            </div>
        </div>
        {{end}}
        {{end}}

        {{else}}
        <!-- Empty State -->
        <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Belum ada pesan</h3>
            <p class="mt-1 text-sm text-gray-500">Pesan akan muncul di sini saat ada percakapan</p>
        </div>
        {{end}}
    </div>
</div>

<script>
// Auto-scroll to bottom on page load
window.addEventListener('DOMContentLoaded', function() {
    const thread = document.getElementById('message-thread');
    if (thread) {
        // Small delay to ensure all content is rendered
        setTimeout(function() {
            thread.scrollTop = thread.scrollHeight;
        }, 100);
    }
});

// Format date helper
function formatMessageDate(dateStr) {
    const date = new Date(dateStr);
    const day = date.getDate();
    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
    const month = monthNames[date.getMonth()];
    const year = date.getFullYear();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');

    return `${day} ${month} ${year}, ${hours}:${minutes}`;
}
</script>
{{end}}
