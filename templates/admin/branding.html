{{define "content"}}
<div class="mb-4 md:mb-6">
      <p class="text-gray-600 mt-1">Sesuaikan tampilan website dengan identitas showroom Anda</p>
</div>

<!-- Branding Settings Form -->
<div class="bg-white rounded-lg shadow p-6" x-data="brandingFormData()">
    <!-- Logo Upload -->
    <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Logo Showroom
        </label>
        <div class="flex items-start space-x-4">
            <div class="flex-1">
                <input type="file"
                       id="logo-upload"
                       @change="handleLogoUpload"
                       accept="image/*"
                       class="block w-full text-sm text-gray-500
                              file:mr-4 file:py-2 file:px-4
                              file:rounded-md file:border-0
                              file:text-sm file:font-semibold
                              file:bg-blue-50 file:text-blue-700
                              hover:file:bg-blue-100">
                <p class="text-sm text-gray-500 mt-1">Format: JPG, PNG, SVG (Max 2MB)</p>
            </div>
            <div class="w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50">
                <img x-show="logoPreview"
                     :src="logoPreview"
                     alt="Logo Preview"
                     class="max-w-full max-h-full object-contain">
                <span x-show="!logoPreview" class="text-gray-400 text-sm">Preview</span>
            </div>
        </div>
        <p x-show="uploadingLogo" class="text-blue-600 text-sm mt-2">Mengupload logo...</p>
    </div>

    <!-- Favicon Upload -->
    <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Favicon (Icon Browser)
        </label>
        <div class="flex items-start space-x-4">
            <div class="flex-1">
                <input type="file"
                       id="favicon-upload"
                       @change="handleFaviconUpload"
                       accept="image/*,.ico"
                       class="block w-full text-sm text-gray-500
                              file:mr-4 file:py-2 file:px-4
                              file:rounded-md file:border-0
                              file:text-sm file:font-semibold
                              file:bg-blue-50 file:text-blue-700
                              hover:file:bg-blue-100">
                <p class="text-sm text-gray-500 mt-1">Format: ICO, PNG (Max 512KB, Rekomendasi: 32x32px)</p>
            </div>
            <div class="w-16 h-16 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50">
                <img x-show="faviconPreview"
                     :src="faviconPreview"
                     alt="Favicon Preview"
                     class="max-w-full max-h-full object-contain">
                <span x-show="!faviconPreview" class="text-gray-400 text-xs">32x32</span>
            </div>
        </div>
        <p x-show="uploadingFavicon" class="text-blue-600 text-sm mt-2">Mengupload favicon...</p>
    </div>

    <div class="border-t border-gray-200 my-6"></div>

    <!-- Custom Title -->
    <div class="mb-6">
        <label for="custom-title" class="block text-sm font-medium text-gray-700 mb-2">
            Judul Custom (Opsional)
        </label>
        <input type="text"
               id="custom-title"
               x-model="form.custom_title"
               maxlength="255"
               placeholder="Contoh: Showroom Mobil Terpercaya"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <p class="text-sm text-gray-500 mt-1">Akan ditampilkan di halaman utama jika diisi</p>
    </div>

    <!-- Custom Subtitle -->
    <div class="mb-6">
        <label for="custom-subtitle" class="block text-sm font-medium text-gray-700 mb-2">
            Subtitle Custom (Opsional)
        </label>
        <input type="text"
               id="custom-subtitle"
               x-model="form.custom_subtitle"
               maxlength="255"
               placeholder="Contoh: Melayani dengan Sepenuh Hati"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <p class="text-sm text-gray-500 mt-1">Subtitle di bawah judul utama</p>
    </div>

    <!-- Promo Text -->
    <div class="mb-6">
        <label for="promo-text" class="block text-sm font-medium text-gray-700 mb-2">
            Teks Promosi (Opsional)
        </label>
        <textarea id="promo-text"
                  x-model="form.promo_text"
                  rows="3"
                  maxlength="500"
                  placeholder="Contoh: Dapatkan diskon spesial untuk pembelian bulan ini!"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
        <p class="text-sm text-gray-500 mt-1">Teks promosi yang akan ditampilkan di homepage</p>
    </div>

    <!-- Header Style -->
    <div class="mb-6">
        <label for="header-style" class="block text-sm font-medium text-gray-700 mb-2">
            Gaya Header
        </label>
        <select id="header-style"
                x-model="form.header_style"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="default">Default</option>
            <option value="modern">Modern</option>
            <option value="classic">Classic</option>
            <option value="minimal">Minimal</option>
        </select>
        <p class="text-sm text-gray-500 mt-1">Pilih gaya tampilan header website</p>
    </div>

    <!-- Error Message -->
    <div x-show="errorMessage" class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
        <p x-text="errorMessage"></p>
    </div>

    <!-- Success Message -->
    <div x-show="successMessage" class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
        <p x-text="successMessage"></p>
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-end space-x-4 border-t border-gray-200 pt-6">
        <a href="/admin/dashboard" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
            Kembali
        </a>
        <button type="button"
                @click="saveSettings"
                :disabled="isSaving"
                class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed">
            <span x-text="isSaving ? 'Menyimpan...' : 'Simpan Pengaturan'"></span>
        </button>
    </div>
</div>

<script>
    function brandingFormData() {
        return {
            form: {
                custom_title: '',
                custom_subtitle: '',
                promo_text: '',
                header_style: 'default'
            },
            logoPreview: null,
            faviconPreview: null,
            uploadingLogo: false,
            uploadingFavicon: false,
            isSaving: false,
            errorMessage: '',
            successMessage: '',

            init() {
                this.loadBrandingSettings();
            },

            loadBrandingSettings() {
                fetch('/api/admin/branding', {
                    headers: {
                        'X-Tenant-ID': document.querySelector('meta[name="tenant-id"]')?.content || ''
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        this.form.custom_title = data.custom_title || '';
                        this.form.custom_subtitle = data.custom_subtitle || '';
                        this.form.promo_text = data.promo_text || '';
                        this.form.header_style = data.header_style || 'default';

                        if (data.logo_path) {
                            this.logoPreview = data.logo_path;
                        }
                        if (data.favicon_path) {
                            this.faviconPreview = data.favicon_path;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading branding settings:', error);
                });
            },

            async handleLogoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                // Validate file size (2MB)
                if (file.size > 2 * 1024 * 1024) {
                    this.errorMessage = 'Ukuran logo terlalu besar (maksimal 2MB)';
                    return;
                }

                // Show preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.logoPreview = e.target.result;
                };
                reader.readAsDataURL(file);

                // Upload file
                this.uploadingLogo = true;
                this.errorMessage = '';

                const formData = new FormData();
                formData.append('logo', file);

                try {
                    const response = await fetch('/api/admin/branding/upload-logo', {
                        method: 'POST',
                        headers: {
                            'X-Tenant-ID': document.querySelector('meta[name="tenant-id"]')?.content || ''
                        },
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.successMessage = 'Logo berhasil diupload!';
                        setTimeout(() => this.successMessage = '', 3000);
                    } else {
                        throw new Error('Upload gagal');
                    }
                } catch (error) {
                    console.error('Error uploading logo:', error);
                    this.errorMessage = 'Gagal mengupload logo';
                } finally {
                    this.uploadingLogo = false;
                }
            },

            async handleFaviconUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                // Validate file size (512KB)
                if (file.size > 512 * 1024) {
                    this.errorMessage = 'Ukuran favicon terlalu besar (maksimal 512KB)';
                    return;
                }

                // Show preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.faviconPreview = e.target.result;
                };
                reader.readAsDataURL(file);

                // Upload file
                this.uploadingFavicon = true;
                this.errorMessage = '';

                const formData = new FormData();
                formData.append('favicon', file);

                try {
                    const response = await fetch('/api/admin/branding/upload-favicon', {
                        method: 'POST',
                        headers: {
                            'X-Tenant-ID': document.querySelector('meta[name="tenant-id"]')?.content || ''
                        },
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.successMessage = 'Favicon berhasil diupload!';
                        setTimeout(() => this.successMessage = '', 3000);
                    } else {
                        throw new Error('Upload gagal');
                    }
                } catch (error) {
                    console.error('Error uploading favicon:', error);
                    this.errorMessage = 'Gagal mengupload favicon';
                } finally {
                    this.uploadingFavicon = false;
                }
            },

            async saveSettings() {
                this.isSaving = true;
                this.errorMessage = '';
                this.successMessage = '';

                try {
                    const response = await fetch('/api/admin/branding', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Tenant-ID': document.querySelector('meta[name="tenant-id"]')?.content || ''
                        },
                        body: JSON.stringify(this.form)
                    });

                    if (response.ok) {
                        this.successMessage = 'Pengaturan branding berhasil disimpan!';
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        throw new Error('Gagal menyimpan pengaturan');
                    }
                } catch (error) {
                    console.error('Error saving branding settings:', error);
                    this.errorMessage = 'Gagal menyimpan pengaturan branding';
                } finally {
                    this.isSaving = false;
                }
            }
        };
    }
</script>
{{end}}
