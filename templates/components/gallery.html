{{define "gallery"}}
{{/*
  Image Gallery Component with Swipe Support
  Usage: {{template "gallery" (dict "images" $images "alt" "Car Name")}}
  Images format: [{"url": "/path/to/image.jpg", "caption": "Front view"}]
*/}}
<div
  x-data="{
    currentIndex: 0,
    images: {{.images | len}},
    touchStartX: 0,
    touchEndX: 0,
    next() {
      this.currentIndex = (this.currentIndex + 1) % this.images;
    },
    prev() {
      this.currentIndex = (this.currentIndex - 1 + this.images) % this.images;
    },
    goTo(index) {
      this.currentIndex = index;
    },
    handleTouchStart(e) {
      this.touchStartX = e.changedTouches[0].screenX;
    },
    handleTouchEnd(e) {
      this.touchEndX = e.changedTouches[0].screenX;
      this.handleSwipe();
    },
    handleSwipe() {
      if (this.touchEndX < this.touchStartX - 50) {
        this.next();
      }
      if (this.touchEndX > this.touchStartX + 50) {
        this.prev();
      }
    }
  }"
  class="relative bg-gray-900 rounded-lg overflow-hidden"
>
  <!-- Main Image Container -->
  <div
    class="relative aspect-video overflow-hidden"
    @touchstart="handleTouchStart($event)"
    @touchend="handleTouchEnd($event)"
  >
    {{range $index, $image := .images}}
    <div
      x-show="currentIndex === {{$index}}"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-300"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="absolute inset-0"
      x-cloak
    >
      <img
        src="{{$image.url}}"
        alt="{{$.alt}} - {{$image.caption}}"
        class="w-full h-full object-cover"
        loading="{{if eq $index 0}}eager{{else}}lazy{{end}}"
      >
      {{if $image.caption}}
      <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
        <p class="text-white text-sm">{{$image.caption}}</p>
      </div>
      {{end}}
    </div>
    {{end}}

    <!-- Navigation Arrows (Desktop) -->
    <button
      @click="prev"
      class="hidden lg:flex absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors"
      aria-label="Previous image"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>

    <button
      @click="next"
      class="hidden lg:flex absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors"
      aria-label="Next image"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>

    <!-- Image Counter -->
    <div class="absolute top-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm">
      <span x-text="currentIndex + 1"></span> / <span x-text="images"></span>
    </div>
  </div>

  <!-- Thumbnail Navigation -->
  <div class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 p-2 bg-gray-800">
    {{range $index, $image := .images}}
    <button
      @click="goTo({{$index}})"
      :class="{ 'ring-2 ring-blue-500': currentIndex === {{$index}} }"
      class="aspect-video overflow-hidden rounded transition-all hover:opacity-75"
    >
      <img
        src="{{$image.url}}"
        alt="Thumbnail {{add $index 1}}"
        class="w-full h-full object-cover"
        loading="lazy"
      >
    </button>
    {{end}}
  </div>

  <!-- Swipe Indicator (Mobile) -->
  <div class="lg:hidden absolute bottom-20 left-0 right-0 flex justify-center gap-2">
    {{range $index, $image := .images}}
    <button
      @click="goTo({{$index}})"
      :class="{ 'bg-white': currentIndex === {{$index}}, 'bg-white/50': currentIndex !== {{$index}} }"
      class="w-2 h-2 rounded-full transition-colors"
      aria-label="Go to image {{add $index 1}}"
    ></button>
    {{end}}
  </div>
</div>
{{end}}

{{define "simple-gallery"}}
{{/*
  Simple Gallery Component (No Thumbnails)
  Usage: {{template "simple-gallery" (dict "images" $images "alt" "Car Name")}}
*/}}
<div
  x-data="{
    currentIndex: 0,
    images: {{.images | len}},
    next() {
      this.currentIndex = (this.currentIndex + 1) % this.images;
    },
    prev() {
      this.currentIndex = (this.currentIndex - 1 + this.images) % this.images;
    }
  }"
  class="relative bg-gray-900 rounded-lg overflow-hidden"
>
  <div class="relative aspect-video">
    {{range $index, $image := .images}}
    <div
      x-show="currentIndex === {{$index}}"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      class="absolute inset-0"
      x-cloak
    >
      <img
        src="{{$image.url}}"
        alt="{{$.alt}}"
        class="w-full h-full object-cover"
        loading="{{if eq $index 0}}eager{{else}}lazy{{end}}"
      >
    </div>
    {{end}}

    <!-- Navigation -->
    <button
      @click="prev"
      class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>

    <button
      @click="next"
      class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>

    <!-- Dots Indicator -->
    <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
      {{range $index, $image := .images}}
      <button
        @click="currentIndex = {{$index}}"
        :class="{ 'bg-white': currentIndex === {{$index}}, 'bg-white/50': currentIndex !== {{$index}} }"
        class="w-2 h-2 rounded-full transition-colors"
      ></button>
      {{end}}
    </div>
  </div>
</div>
{{end}}
